<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Minimal Text</title>

<!-- PWA + Icons -->
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-512.png">
<link rel="apple-touch-icon" href="icon-512.png">
<meta name="theme-color" content="#3b2f2f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #3b2f2f;
    color: #000;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #editor {
    width: 92%;
    max-width: 480px;
    height: 32vh;
    padding: 18px;
    font-size: 22px;
    line-height: 1.5;
    border: none;
    outline: none;
    resize: none;
    background: #bbf7d0; /* soft mint green */
    border-radius: 14px;
    margin-top: 14px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    transition: box-shadow 0.2s ease;
  }

  /* Focus ring on textbox */
  #editor:focus {
    outline: 2px solid #22c55e;
    outline-offset: 2px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  }

  #editor.bold { font-weight: bold; }
  #editor.caps { text-transform: uppercase; }

  .toolbar {
    width: 92%;
    max-width: 480px;
    display: flex;
    gap: 10px;
    margin: 10px 0 6px;
  }

  .toolbar button {
    flex: 1;
    padding: 8px 0;
    font-size: 14px;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    background: linear-gradient(145deg,#f1f3f5,#e2e5e8);
    color: #111;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    transition: transform 0.1s ease, background 0.2s ease;
  }

  .toolbar button.active {
    background: #2563eb;
    color: #fff;
  }

  .toolbar button:active {
    transform: scale(0.95);
    background: linear-gradient(145deg,#d0d3d6,#f1f3f5);
  }

  .templates {
    width: 92%;
    max-width: 480px;
    margin-top: 10px;
    max-height: 220px; /* scroll if overflow */
    overflow-y: auto;
  }

  .templates h3 {
    font-size: 14px;
    font-weight: 600;
    color: #ddd;
    margin-bottom: 6px;
  }

  .template-item {
    display: flex;
    gap: 6px;
    margin-bottom: 8px;
  }

  .template-item button.template-text {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 10px;
    background: #eef2ff;
    font-size: 15px;
    text-align: left;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.1s ease;
  }

  .template-item button.template-text:active {
    transform: scale(0.97);
  }

  .template-item button.delete {
    width: 36px;
    border: none;
    border-radius: 10px;
    background: #ef4444;
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.1s ease;
  }

  .template-item button.delete:active {
    transform: scale(0.95);
  }

  .templates .add {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: none;
    border-radius: 10px;
    background: #d1fae5; /* lighter mint green */
    color: #065f46;
    font-weight: 600;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.1s ease;
  }

  .templates .add:active {
    transform: scale(0.97);
  }

  #watermarkToggle {
    display: flex;
    align-items: center;
    font-size: 12px;
    color: #ccc;
    margin-top: 4px;
    gap: 4px;
  }

</style>
</head>
<body>

<textarea id="editor" maxlength="160" placeholder="Type short message (max 160 chars)â€¦"></textarea>

<div class="toolbar" id="toolbar">
  <button id="boldBtn">B</button>
  <button id="capsBtn">CAPS</button>
  <button id="copyBtn">ðŸ“‹ Copy</button>
  <button id="clearBtn">ðŸ—‘ Clear</button>
  <button id="shotBtn">ðŸ“¸</button>
</div>

<div id="watermarkToggle">
  <input type="checkbox" id="toggleWatermark" checked>
  <label for="toggleWatermark">Include watermark in screenshot</label>
</div>

<div class="templates">
  <h3>Templates</h3>
  <button class="add" id="addTemplateBtn">+ Save current text as template</button>
  <div id="templateList"></div>
</div>

<script>
  const editor = document.getElementById('editor');
  const boldBtn = document.getElementById('boldBtn');
  const capsBtn = document.getElementById('capsBtn');
  const copyBtn = document.getElementById('copyBtn');
  const clearBtn = document.getElementById('clearBtn');
  const shotBtn = document.getElementById('shotBtn');
  const toolbar = document.getElementById('toolbar');
  const watermarkToggle = document.getElementById('toggleWatermark');

  const addTemplateBtn = document.getElementById('addTemplateBtn');
  const templateList = document.getElementById('templateList');

  let templates = JSON.parse(localStorage.getItem('templates') || '[]');

  function renderTemplates() {
    templateList.innerHTML = '';
    templates.forEach((text, index) => {
      const row = document.createElement('div');
      row.className = 'template-item';

      const textBtn = document.createElement('button');
      textBtn.className = 'template-text';
      textBtn.textContent = text;
      textBtn.onclick = () => editor.value = text;

      const delBtn = document.createElement('button');
      delBtn.className = 'delete';
      delBtn.textContent = 'Ã—';
      delBtn.onclick = () => {
        templates.splice(index, 1);
        localStorage.setItem('templates', JSON.stringify(templates));
        renderTemplates();
      };

      row.appendChild(textBtn);
      row.appendChild(delBtn);
      templateList.appendChild(row);
    });
  }
  renderTemplates();

  addTemplateBtn.onclick = () => {
    if (!editor.value.trim()) return;
    templates.unshift(editor.value.trim());
    templates = templates.slice(0, 10);
    localStorage.setItem('templates', JSON.stringify(templates));
    renderTemplates();
    editor.value = ''; // auto-clear after saving
  };

  boldBtn.onclick = () => {
    editor.classList.toggle('bold');
    boldBtn.classList.toggle('active');
  };

  capsBtn.onclick = () => {
    editor.classList.toggle('caps');
    capsBtn.classList.toggle('active');
  };

  copyBtn.onclick = async () => {
    await navigator.clipboard.writeText(editor.value);
    copyBtn.textContent = 'âœ“ Copied';
    setTimeout(() => copyBtn.textContent = 'ðŸ“‹ Copy', 800);
  };

  clearBtn.onclick = () => {
    editor.value = '';
  };

  async function takeScreenshot() {
    toolbar.style.display = 'none';

    const tempDiv = document.createElement('div');
    tempDiv.style.width = editor.offsetWidth + 'px';
    tempDiv.style.padding = '18px';
    tempDiv.style.fontSize = window.getComputedStyle(editor).fontSize;
    tempDiv.style.lineHeight = window.getComputedStyle(editor).lineHeight;
    tempDiv.style.fontWeight = editor.classList.contains('bold') ? 'bold' : 'normal';
    tempDiv.style.textTransform = editor.classList.contains('caps') ? 'uppercase' : 'none';
    tempDiv.style.background = '#bbf7d0';
    tempDiv.style.borderRadius = '14px';
    tempDiv.textContent = editor.value;

    document.body.appendChild(tempDiv);

    const canvas = await html2canvas(tempDiv, { backgroundColor: null });

    if (watermarkToggle.checked) {
      const ctx = canvas.getContext('2d');
      const text = "use free tool to capture screenshot like this - pprashil26.github.io/textbox";
      ctx.font = "10px sans-serif";
      ctx.fillStyle = "rgba(0,0,0,0.3)";
      ctx.textAlign = "center";
      ctx.fillText(text, canvas.width / 2, canvas.height - 6);
    }

    canvas.toBlob(async blob => {
      const file = new File([blob], 'text.png', { type: 'image/png' });
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({ files: [file] });
      } else {
        const link = document.createElement('a');
        link.download = 'text.png';
        link.href = URL.createObjectURL(file);
        link.click();
      }
      toolbar.style.display = 'flex';
      document.body.removeChild(tempDiv);
    });
  }

  shotBtn.onclick = takeScreenshot;

  let twoFinger = false;
  document.addEventListener('touchstart', e => { if(e.touches.length===2) twoFinger=true; });
  document.addEventListener('touchend', () => { if(twoFinger){takeScreenshot();twoFinger=false;} });
</script>

</body>
</html>
