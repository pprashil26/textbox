<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Minimal Text</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-512.png">
<link rel="apple-touch-icon" href="icon-512.png">
<meta name="theme-color" content="#3b2f2f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #3b2f2f;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#editor {
  width: 92%;
  max-width: 480px;
  min-height: 32vh;
  padding: 18px;
  font-size: 22px;
  line-height: 1.5;
  border: none;
  outline: none;
  resize: none;
  background: #bbf7d0;
  border-radius: 14px;
  margin-top: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  overflow: hidden;
  font-family: inherit;
}

#editor:focus {
  outline: 2px solid #22c55e;
  outline-offset: 2px;
}

#editor.bold { font-weight: bold; }
#editor.caps { text-transform: uppercase; }

#charCount {
  width: 92%;
  max-width: 480px;
  text-align: right;
  font-size: 12px;
  color: #ddd;
  margin-top: 4px;
  margin-bottom: 6px;
}

.toolbar {
  width: 92%;
  max-width: 480px;
  display: flex;
  gap: 10px;
  margin: 10px 0 6px;
}

.toolbar button {
  flex: 1;
  padding: 8px 0;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  background: #4a3838;
  color: #fff;
}

.toolbar button.active { background: #2563eb; }

.templates-controls {
  width: 92%;
  max-width: 480px;
  display: flex;
  gap: 6px;
  margin: 10px 0 4px;
  flex-wrap: wrap;
}

.templates-controls button {
  flex: 1;
  border: none;
  border-radius: 10px;
  padding: 6px 10px;
  font-size: 13px;
  background: #4a3838;
  color: #fff;
  font-weight: 600;
}

.templates {
  width: 92%;
  max-width: 480px;
}

.templates h3 {
  font-size: 14px;
  font-weight: 600;
  color: #ddd;
  margin-bottom: 6px;
}

.template-item {
  display: flex;
  gap: 6px;
  margin-bottom: 8px;
  align-items: flex-start;
}

.template-text {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 10px;
  background: #4a3838;
  color: #fff;
  font-size: 15px;
  text-align: left;
  white-space: pre-wrap;
}

.pin, .delete {
  width: 36px;
  height: 36px;
  min-width: 36px;
  border: none;
  border-radius: 50%;
  background: #4a3838;
  color: #fff;
  font-size: 16px;
  font-weight: 600;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 2px;
}

.pin.active {
  background: #fff; 
  color: #4a3838;
}

.templates .add {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 10px;
  background: #4a3838;
  color: #fff;
  font-weight: 600;
  text-align: center;
}
</style>
</head>
<body>

<textarea id="editor" maxlength="160" placeholder="Type short message (max 160 chars)â€¦"></textarea>
<div id="charCount">160</div>

<div class="toolbar" id="toolbar">
  <button id="boldBtn">B</button>
  <button id="capsBtn">CAPS</button>
  <button id="copyBtn">ðŸ“‹ Copy</button>
  <button id="clearBtn">ðŸ—‘ Clear</button>
  <button id="shotBtn">ðŸ“¸</button>
</div>

<div class="templates-controls">
  <button id="addTemplateBtn">+ Save as template</button>
  <button id="toggleTemplatesBtn">Hide Templates</button>
  <button id="backupBtn">Backup</button>
</div>

<div id="backupSection" style="display:none; width:92%; max-width:480px; margin-bottom:10px; gap:6px; flex-wrap:wrap; display:flex;">
  <button id="exportTemplatesBtn">Export Templates</button>
  <button id="importTemplatesBtn">Import Templates</button>
  <input type="file" id="importFile" style="display:none;">
</div>

<div class="templates" id="templatesSection">
  <h3>Templates</h3>
  <div id="templateList"></div>
</div>

<script>
const editor = document.getElementById('editor');
const boldBtn = document.getElementById('boldBtn');
const capsBtn = document.getElementById('capsBtn');
const copyBtn = document.getElementById('copyBtn');
const clearBtn = document.getElementById('clearBtn');
const shotBtn = document.getElementById('shotBtn');

const addTemplateBtn = document.getElementById('addTemplateBtn');
const toggleTemplatesBtn = document.getElementById('toggleTemplatesBtn');
const backupBtn = document.getElementById('backupBtn');
const backupSection = document.getElementById('backupSection');
const exportTemplatesBtn = document.getElementById('exportTemplatesBtn');
const importTemplatesBtn = document.getElementById('importTemplatesBtn');
const importFile = document.getElementById('importFile');

const templateList = document.getElementById('templateList');
let templates = JSON.parse(localStorage.getItem('templates') || '[]');
let templatesVisible = JSON.parse(localStorage.getItem('templatesVisible') ?? 'true');

function renderTemplates() {
  templateList.innerHTML = '';
  if (!templatesVisible) return;

  const pinned = templates.filter(t => t.pinned);
  const unpinned = templates.filter(t => !t.pinned);
  const allTemplates = [...pinned, ...unpinned];

  allTemplates.forEach((t) => {
    const row = document.createElement('div');
    row.className = 'template-item';

    const textBtn = document.createElement('button');
    textBtn.className = 'template-text';
    textBtn.textContent = t.text;
    textBtn.onclick = () => editor.value = t.text;

    const pinBtn = document.createElement('button');
    pinBtn.className = 'pin';
    pinBtn.textContent = 'ðŸ“Œ';
    if (t.pinned) pinBtn.classList.add('active');
    pinBtn.onclick = () => {
      t.pinned = !t.pinned;
      localStorage.setItem('templates', JSON.stringify(templates));
      renderTemplates();
    };

    const delBtn = document.createElement('button');
    delBtn.className = 'delete';
    delBtn.textContent = 'Ã—';
    delBtn.onclick = () => {
      templates = templates.filter(temp => temp !== t);
      localStorage.setItem('templates', JSON.stringify(templates));
      renderTemplates();
    };

    row.appendChild(textBtn);
    row.appendChild(pinBtn);
    row.appendChild(delBtn);
    templateList.appendChild(row);
  });
}

renderTemplates();

// Toggle templates
toggleTemplatesBtn.onclick = () => {
  templatesVisible = !templatesVisible;
  localStorage.setItem('templatesVisible', JSON.stringify(templatesVisible));
  toggleTemplatesBtn.textContent = templatesVisible ? 'Hide Templates' : 'Show Templates';
  renderTemplates();
};

// Add template
addTemplateBtn.onclick = () => {
  if (!editor.value.trim()) return;
  templates.unshift({ text: editor.value.trim(), pinned: false });
  localStorage.setItem('templates', JSON.stringify(templates));
  renderTemplates();
  editor.value = '';
  updateCharCount();
};

// Backup toggle
backupBtn.onclick = () => {
  backupSection.style.display = backupSection.style.display==='flex'?'none':'flex';
};

// Export templates
exportTemplatesBtn.onclick = () => {
  const data = templates.map(t => t.text).join('\n---\n');
  const blob = new Blob([data], {type:'text/plain'});
  const link = document.createElement('a');
  link.download = 'templates.txt';
  link.href = URL.createObjectURL(blob);
  link.click();
};

// Import templates
importTemplatesBtn.onclick = () => importFile.click();
importFile.onchange = (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    const imported = ev.target.result.split('\n---\n').map(text => ({text, pinned:false}));
    templates = [...imported, ...templates];
    localStorage.setItem('templates', JSON.stringify(templates));
    renderTemplates();
    importFile.value = '';
  };
  reader.readAsText(file);
};

// Bold, Caps, Copy, Clear
boldBtn.onclick = () => { editor.classList.toggle('bold'); boldBtn.classList.toggle('active'); };
capsBtn.onclick = () => { editor.classList.toggle('caps'); capsBtn.classList.toggle('active'); };
copyBtn.onclick = async () => {
  await navigator.clipboard.writeText(editor.value);
  copyBtn.textContent = 'âœ“ Copied';
  setTimeout(() => copyBtn.textContent = 'ðŸ“‹ Copy', 800);
};
clearBtn.onclick = () => { editor.value = ''; updateCharCount(); };

// Character countdown
const charCount = document.getElementById('charCount');
function updateCharCount() {
  charCount.textContent = 160 - editor.value.length;
}
editor.addEventListener('input', () => { updateCharCount(); autoGrow(); });

// Auto-grow
function autoGrow() {
  editor.style.height = 'auto';
  editor.style.height = (editor.scrollHeight) + 'px';
}
autoGrow();

// Screenshot
async function takeScreenshot() {
  const toolbar = document.getElementById('toolbar');
  toolbar.style.display = 'none';

  const tempDiv = document.createElement('div');
  tempDiv.style.width = editor.offsetWidth + 'px';
  tempDiv.style.padding = '18px';
  tempDiv.style.fontSize = window.getComputedStyle(editor).fontSize;
  tempDiv.style.lineHeight = window.getComputedStyle(editor).lineHeight;
  tempDiv.style.fontWeight = editor.classList.contains('bold') ? 'bold' : 'normal';
  tempDiv.style.textTransform = editor.classList.contains('caps') ? 'uppercase' : 'none';
  tempDiv.style.background = '#bbf7d0';
  tempDiv.style.borderRadius = '14px';
  tempDiv.style.fontFamily = '"Patrick Hand", cursive';

  const pre = document.createElement('pre');
  pre.style.margin = '0';
  pre.style.font = 'inherit';
  pre.style.whiteSpace = 'pre-wrap';
  pre.style.color = '#3b2f2f';
  pre.textContent = editor.value;
  tempDiv.appendChild(pre);

  document.body.appendChild(tempDiv);
  const canvas = await html2canvas(tempDiv, { backgroundColor: null });

  canvas.toBlob(async blob => {
    const file = new File([blob], 'text.png', { type: 'image/png' });
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({ files: [file] });
    } else {
      const link = document.createElement('a');
      link.download = 'text.png';
      link.href = URL.createObjectURL(file);
      link.click();
    }
    toolbar.style.display = 'flex';
    document.body.removeChild(tempDiv);
  });
}
shotBtn.onclick = takeScreenshot;

let twoFinger = false;
document.addEventListener('touchstart', e => { if(e.touches.length===2) twoFinger=true; });
document.addEventListener('touchend', () => { if(twoFinger){takeScreenshot();twoFinger=false;} });
</script>

</body>
</html>
